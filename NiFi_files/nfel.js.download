(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","CodeMirror"],function(d,c){return(nf.nfel=b(d,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.nfel=b(require("jquery"),require("CodeMirror")))}else{nf.nfel=b(a.$,a.CodeMirror)}}}(this,function(e,s){var x=function(y){if(e.isEmptyObject(y)){return'<span class="unset">None</span>'}else{var z='<div class="clear"></div><ul class="el-arguments">';e.each(y,function(A,B){z+=('<li><span class="el-argument-name">'+A+"</span> - "+B+"</li>")});z+="</ul>";return z}};var t=[];var m=[];var k=new RegExp("^$");var f=new RegExp("^$");var b={};e.ajax({type:"GET",url:"../nifi-docs/html/expression-language-guide.html",dataType:"html"}).done(function(y){e(y).find("div.function").each(function(){var G=e(this);var D=G.find("h3").text();var F=G.find("span.description").text();var C=G.find("span.returnType").text();var E;var B=E=G.find("span.subject");var A=G.find("span.subjectless");if(A.length){t.push(D);E='<span class="unset">None</span>'}if(B.length){m.push(D);E=G.find("span.subject").text()}var z={};G.find("span.argName").each(function(){var I=e(this);var H=I.next("span.argDesc");z[I.text()]=H.text()});b[D]='<div><div class="el-name el-section">'+D+'</div><div class="el-section">'+F+'</div><div class="el-section"><div class="el-header">Arguments</div>'+x(z)+'</div><div class="el-section"><div class="el-header">Subject</div><p>'+E+'</p><div class="clear"></div></div><div class="el-section"><div class="el-header">Returns</div><p>'+C+'</p><div class="clear"></div></div></div>'})}).always(function(){k=new RegExp("^(("+t.join(")|(")+"))$");f=new RegExp("^(("+m.join(")|(")+"))$")});var w="subject";var g="function";var h="subject-or-function";var p="expression";var r="arguments";var a="argument";var v="invalid";var c=function(z,y){var A=0;z.eatWhile(function(B){if(B==="$"){A++;return true}return false});if(A%2===0){return null}if(A>1){z.backUp(1);return null}if(z.peek()==="{"){z.next();y.push({context:p});z.eatSpace();return"bracket"}else{return null}};var i=function(D,B){var C=D.next();var y=false;var A=false;var z=D.eatWhile(function(E){if(y===true){return false}if(E===C){y=A===false}A=false;if(E==="\\"){A=true}return true});if(z){return"string"}B.context=v;D.skipToEnd();return null};var d=null;var u=null;var q=[];var n=function(y,z){j();d=e(z).qtip("api");u=setTimeout(function(){d.show()},500)};var j=function(){if(u!==null){clearInterval(u);u=null}if(d!==null){d.hide()}};var l=function(){if(u!==null){clearInterval(u);u=null}d=null;e.each(q,function(y,z){z.destroy(true)});q=[]};var o=function(A,z,C){var B=e("<div></div>").text(C.text);var y=e(A).qtip({content:b[C.text],style:{classes:"nifi-tooltip nfel-tooltip",tip:false,width:350},show:{event:false,effect:false},hide:{event:false,effect:false},position:{at:"bottom right",my:"bottom left",adjust:{x:20}}}).append(B);q.push(y.qtip("api"))};return{color:function(){var y=function(A){var z=A;return{copy:function(){var C=[];for(var B=0;B<z.length;B++){C.push({context:z[B].context})}return C},get:function(){if(z.length===0){return{context:null}}else{return z[z.length-1]}},push:function(B){return z.push(B)},pop:function(){return z.pop()}}};return{startState:function(){return y([])},copyState:function(z){return y(z.copy())},token:function(I,J){if(I.eatSpace()){return null}if(I.eol()){return null}var F=I.peek();if(F==="#"){I.skipToEnd();return"comment"}var B=J.get();if(B.context===v){I.skipToEnd();return null}if(B.context===p){var D=/^[^'"#${}()[\],:;\/*\\\s\t\r\n0-9][^'"#${}()[\],:;\/*\\\s\t\r\n]*/;var A=I.match(D,false);if(A!==null&&A.length===1){I.match(D);if(k.test(A)&&I.peek()==="("){B.context=r;return"builtin"}else{B.context=h;return"variable-2"}}else{if(F==="'"||F==='"'){var C=i(I,B);if(C!==null){B.context=w}return C}else{if(F==="$"){var E=c(I,J);if(E!==null){B.context=w}return E}else{if(F==="}"){I.next();if(typeof J.pop()==="undefined"){return null}else{return"bracket"}}else{I.skipToEnd();B.context=v;return null}}}}}if(B.context===w||B.context===h){if(F===":"){I.next();B.context=g;I.eatSpace();return null}else{if(F==="}"){I.next();if(typeof J.pop()==="undefined"){return null}else{return"bracket"}}else{I.skipToEnd();B.context=v;return null}}}if(B.context===g){var G=I.match(/^[a-zA-Z]+/,false);if(G!==null&&G.length===1){I.match(/^[a-zA-Z]+/);if(f.test(G)&&I.peek()==="("){B.context=r;return"builtin"}else{return null}}else{I.skipToEnd();B.context=v;return null}}if(B.context===r){if(F==="("){I.next();B.context=a;return null}else{if(F===")"){I.next();B.context=w;return null}else{if(F===","){I.next();B.context=a;return null}else{I.skipToEnd();B.context=v;return null}}}}if(B.context===a){if(F==="'"||F==='"'){var H=i(I,B);if(H!==null){B.context=r}return H}else{if(I.match(/^[-\+]?((([0-9]+\.[0-9]*)([eE][+-]?([0-9])+)?)|((\.[0-9]+)([eE][+-]?([0-9])+)?)|(([0-9]+)([eE][+-]?([0-9])+)))/)){B.context=r;return"number"}else{if(I.match(/^[-\+]?[0-9]+/)){B.context=r;return"number"}else{if(I.match(/^((true)|(false))/)){B.context=r;return"number"}else{if(F===")"){I.next();B.context=w;return null}else{if(F==="$"){var z=c(I,J);if(z!==null){B.context=r}return z}else{I.skipToEnd();B.context=v;return null}}}}}}}if(F==="$"){return c(I,J)}if(F==="}"){I.next();if(typeof J.pop()==="undefined"){return null}else{return"bracket"}}I.next();return}}},suggest:function(F){var J=F.getCursor();var B=F.getTokenAt(J);var C=false;var y=B.state.get();var A=function(L){return L===g||L===r};var K=function(L){return L===p||L===h};var z=y.context;if(!K(z)&&!A(z)){return null}var I=B.string.toLowerCase();var E=e.trim(I);if(E==="${"||E===":"){C=true;B.start+=I.length}var G=function(M){var L=[];e.each(M,function(O,N){if(e.inArray(N,L)===-1){if(C||N.toLowerCase().indexOf(I)===0){L.push({text:N,render:o})}}});return L};var D=G(K(z)?t:m);D=D.sort(function(N,L){var O=N.text.toLowerCase();var M=L.text.toLowerCase();return O===M?0:O>M?1:-1});var H={list:D,from:{line:J.line,ch:B.start},to:{line:J.line,ch:B.end}};s.on(H,"select",n);s.on(H,"close",l);return H}}}));